# Настройка Битрикс24

## Пошаговая инструкция

### 1. Создание аккаунта
1. Перейдите на [bitrix24.ru](https://bitrix24.ru)
2. Зарегистрируйтесь или войдите в существующий аккаунт
3. Выберите тарифный план (для тестирования подойдет бесплатный)

### 2. Получение Webhook URL
1. В левом меню выберите **Приложения**
2. Перейдите в раздел **Разработчикам**
3. Выберите **Другое**
4. Нажмите **Входящий вебхук**
5. Нажмите **Включить демо-тариф**
6. Скопируйте полученный URL

### 3. Настройка переменных окружения
1. Создайте файл `.env.local` в корне проекта
2. Добавьте строку:
```env
BITRIX_WEBHOOK_URL=ваш_webhook_url_здесь
```

### 4. Создание тестовых сделок
1. В Битрикс24 перейдите в раздел **CRM**
2. Выберите **Сделки**
3. Создайте несколько тестовых сделок с разными статусами:
   - Новая (NEW)
   - В работе (PREPARATION)
   - Ожидает оплаты (PREPAYMENT_INVOICE)
   - Выполняется (EXECUTING)
   - Счет выставлен (FINAL_INVOICE)
   - Оплачена (WON)
   - Отменена (LOSE)

### 5. Тестирование интеграции
1. Запустите проект: `npm run dev`
2. Откройте http://localhost:3000
3. Зарегистрируйтесь или войдите
4. Перейдите на страницу "Платежи"
5. Проверьте, что сделки загружаются из Битрикс24

## Возможные проблемы

### Ошибка "Webhook URL не настроен"
- Проверьте, что файл `.env.local` создан и содержит правильный URL
- Перезапустите сервер после изменения переменных окружения

### Сделки не загружаются
- Убедитесь, что в Битрикс24 есть сделки с суммой больше 0
- Проверьте, что webhook URL корректный
- Посмотрите логи в консоли браузера и терминале

### Ошибки при создании контактов
- Проверьте права доступа webhook'а
- Убедитесь, что демо-тариф активен

## API методы Битрикс24

Проект использует следующие методы API:
- `crm.contact.add` - создание контакта
- `crm.deal.list` - получение списка сделок
- `crm.deal.update` - обновление сделки
